<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compressly — Fast client-side image compression</title>
  <meta name="description" content="Compressly — fast, secure, client-side image compressor. Remove EXIF, choose compression level, preview and download optimized images instantly." />
  <meta name="keywords" content="image compression, compress jpeg, compress png, webp converter, strip exif, image optimizer, Compressly" />
  <meta name="author" content="Compressly" />
  <link rel="canonical" href="https://www.compressly.example/" />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph -->
  <meta property="og:title" content="Compressly — Fast client-side image compression" />
  <meta property="og:description" content="Compressly compresses your images right in the browser — no upload, no privacy risk. Supports JPEG, PNG, WebP, AVIF, GIF and SVG." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.compressly.example/" />
  <meta property="og:image" content="https://www.compressly.example/og-image.png" />

  <!-- Structured data JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Compressly",
    "url": "https://www.compressly.example/",
    "description": "Client-side image compression tool that removes EXIF data and gives control over compression level.",
    "applicationCategory": "ImageProcessingApplication",
    "operatingSystem": "All",
    "offers": {
      "@type": "Offer",
      "price": "0.00",
      "priceCurrency": "USD"
    }
  }
  </script>

  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#0f62fe; --glass: rgba(255,255,255,0.6);
      --shadow: 0 8px 24px rgba(12,18,36,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    [data-theme="dark"]{
      --bg:#0b1020; --card:#0f1724; --muted:#9aa4b2; --accent:#6ea8ff; --glass: rgba(255,255,255,0.04);
      color-scheme: dark;
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:linear-gradient(180deg,var(--bg), #fff); font-size:15px; color:var(--muted); -webkit-font-smoothing:antialiased;}
    header{display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem; max-width:1200px; margin:0 auto;}
    .brand{display:flex; align-items:center; gap:.75rem; font-weight:700; color:var(--accent); font-size:1.15rem}
    .brand .logo{width:42px; height:42px; display:grid; place-items:center; border-radius:10px; background:linear-gradient(135deg,#0f62fe,#7b61ff); color:white; font-weight:800; box-shadow:var(--shadow)}
    .layout{max-width:1200px; margin:1rem auto; padding:1rem; display:grid; grid-template-columns: 1fr 320px; gap:1rem;}
    @media (max-width:960px){ .layout{grid-template-columns:1fr; padding:0.75rem;} .sidebar{order:2} header{padding:.5rem}}
    .card{background:var(--card); border-radius:12px; padding:1rem; box-shadow:var(--shadow)}
    .uploader{min-height:220px; border:2px dashed rgba(0,0,0,0.06); border-radius:12px; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:.75rem; padding:1rem; background:linear-gradient(180deg, transparent, var(--glass))}
    .uploader.dragover{border-color:var(--accent); transform:translateY(-3px); transition:all .18s ease}
    .muted{color:var(--muted); font-size:.95rem}
    .controls{display:flex; gap:1rem; align-items:center; margin-top:.75rem; flex-wrap:wrap}
    input[type="range"]{width:220px}
    .btn{background:var(--accent); color:white; padding:.6rem .9rem; border-radius:10px; border:0; cursor:pointer; font-weight:600; box-shadow:0 6px 18px rgba(15,98,254,0.14)}
    .btn.secondary{background:transparent; color:var(--muted); box-shadow:none; border:1px solid rgba(0,0,0,0.06)}
    .preview{display:flex; gap:1rem; align-items:flex-start; margin-top:1rem; flex-wrap:wrap}
    .preview img{max-width:100%; border-radius:8px; box-shadow:0 6px 16px rgba(12,18,36,0.06)}
    .meta{font-size:.92rem; color:var(--muted)}
    .sidebar{display:flex; flex-direction:column; gap:1rem; min-height:200px}
    .tools-list{list-style:none; padding:0; margin:0}
    .tools-list li{padding:.6rem .75rem; border-radius:8px; cursor:pointer; color:var(--muted); display:flex; align-items:center; gap:.6rem}
    .tools-list li.active{background:linear-gradient(90deg, rgba(15,98,254,0.06), rgba(123,97,255,0.03)); color:var(--accent); font-weight:600}
    .ads-placeholder{background:linear-gradient(90deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01)); border-radius:8px; padding:0.5rem; text-align:center; color:var(--muted); font-size:.9rem}
    footer{max-width:1200px; margin:1.25rem auto; padding:0 1rem; display:flex; justify-content:space-between; align-items:center; gap:1rem}
    .small{font-size:.85rem; color:var(--muted)}
    .result-area{margin-top:1rem}
    .row{display:flex; gap:1rem; align-items:center; flex-wrap:wrap}
    .switch{display:inline-flex; gap:.5rem; align-items:center}
    .toggle{width:46px; height:28px; border-radius:999px; background:rgba(0,0,0,0.08); position:relative; padding:3px; cursor:pointer}
    .toggle .knob{width:22px; height:22px; background:white; border-radius:999px; position:absolute; top:3px; left:3px; transition:transform .18s cubic-bezier(.2,.9,.2,1)}
    [data-theme="dark"] .toggle{background:rgba(255,255,255,0.08)}
    [data-theme="dark"] .toggle.on .knob{transform:translateX(18px)}
    .hidden{display:none}
    .note{font-size:.85rem; color:var(--muted)}
    .inputfile{display:none}
    .center{display:grid; place-items:center}
    .download-btn{display:inline-flex; gap:.5rem; align-items:center}
    .result-card{display:flex; gap:1rem; align-items:center; justify-content:space-between; padding:.75rem; border-radius:10px; background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent)}
    .size-info{font-weight:700; color:var(--muted)}
    .spinner{width:20px; height:20px; border-radius:50%; border:3px solid rgba(0,0,0,0.06); border-top-color:var(--accent); animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="brand">
      <div class="logo">C</div>
      <div>
        <div style="font-size:1rem">Compressly</div>
        <div style="font-size:.8rem; color:var(--muted)">Client-side image compression</div>
      </div>
    </div>

    <div style="display:flex; align-items:center; gap:.75rem;">
      <div class="switch" title="Theme">
        <div id="themeToggle" class="toggle" role="button" aria-pressed="false" tabindex="0">
          <div class="knob"></div>
        </div>
      </div>

      <button id="privacyBtn" class="btn secondary" aria-haspopup="dialog">Privacy Policy</button>
    </div>
  </header>

  <main class="layout">
    <!-- Main Column -->
    <section>
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem;">
          <div>
            <h2 style="margin:.15rem 0 0 0">Compress your image</h2>
            <div class="muted" style="margin-top:.25rem">Single image — up to 10 MB. EXIF removed by default.</div>
          </div>
          <div class="row">
            <label for="formatSelect" class="muted">Output format</label>
            <select id="formatSelect" aria-label="Output format">
              <option value="orig">Keep original</option>
              <option value="image/jpeg">JPEG</option>
              <option value="image/png">PNG</option>
              <option value="image/webp">WebP</option>
              <option value="image/avif">AVIF</option>
              <option value="image/svg+xml">SVG (rasterized)</option>
            </select>
          </div>
        </div>

        <div id="uploader" class="uploader" tabindex="0" aria-label="Upload area. Drop an image or click to select.">
          <input id="fileInput" type="file" accept="image/*" class="inputfile" />
          <div id="uploaderInner" class="center">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden>
              <path d="M12 3v9" stroke="#0f62fe" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#0f62fe" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7 10l5-5 5 5" stroke="#0f62fe" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div style="font-weight:700">Drop your image here</div>
            <div class="muted">or <button id="browseBtn" class="btn secondary">Browse</button></div>
            <div class="note" style="margin-top:.5rem">Supported: JPEG, PNG, WebP, AVIF, GIF, SVG — max 10MB</div>
          </div>
        </div>

        <div class="controls" style="margin-top:1rem">
          <label class="muted">Compression</label>
          <input id="qualityRange" type="range" min="1" max="100" value="85" aria-label="Compression level">
          <div id="qualityVal" class="muted">85%</div>

          <button id="presetLow" class="btn secondary">Low</button>
          <button id="presetMed" class="btn secondary">Medium</button>
          <button id="presetHigh" class="btn secondary">High</button>

          <label class="muted" style="margin-left:auto"><input id="stripExif" type="checkbox" checked /> Remove EXIF</label>
        </div>

        <!-- AdSense placeholder between upload and results -->
        <div id="adsBetween" style="margin-top:1rem" class="ads-placeholder card">
          <!-- Replace with your AdSense ad slot. Example: -->
          <!-- <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-XXXXXXXXXXXX"
               data-ad-slot="1234567890"
               data-ad-format="auto"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> -->
          ADS — replace this block with your AdSense code (between results).
        </div>

        <div class="result-area" id="resultArea" aria-live="polite"></div>
      </div>

      <!-- Result / Download area -->
      <div id="resultCardWrap" class="card" style="margin-top:1rem; display:none">
        <div class="result-card">
          <div style="display:flex; gap:1rem; align-items:center">
            <div id="thumbWrap" style="width:120px; height:80px; display:grid; place-items:center; overflow:hidden; border-radius:8px; background:linear-gradient(180deg,#fff,#f7f8fc)">
              <img id="previewImg" alt="Preview" style="max-width:120px; max-height:80px; display:block;">
            </div>
            <div>
              <div id="fileName" class="muted">filename.jpg</div>
              <div class="meta" id="sizeInfo">Original: — • Compressed: —</div>
            </div>
          </div>

          <div style="display:flex; gap:.5rem; align-items:center">
            <button id="downloadBtn" class="btn download-btn" aria-label="Download compressed image">Download</button>
            <button id="resetBtn" class="btn secondary">Reset</button>
          </div>
        </div>
      </div>

    </section>

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="card">
        <h3 style="margin:.15rem 0">Tools</h3>
        <ul class="tools-list" role="list">
          <li class="active">Image Compressor</li>
          <li>Resize (future)</li>
          <li>Convert to WebP/AVIF (future)</li>
          <li>Batch Compressor (future)</li>
        </ul>
      </div>

      <div class="card">
        <h4 style="margin:.15rem 0">Advertisement</h4>
        <div class="ads-placeholder" style="min-height:160px">
          <!-- Sidebar AdSense placeholder -->
          Sidebar ADS — replace with AdSense code
        </div>
      </div>

      <div class="card small">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <div style="font-weight:700">Compressly</div>
            <div class="muted">Fast. Private. Client-side.</div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <footer>
    <div class="small">© <strong>Compressly</strong> <span id="year"></span> • <a id="privacyLink" href="#" class="muted">Privacy Policy</a></div>
    <div class="small">ADS (footer) — place your AdSense code here</div>
  </footer>

  <!-- Privacy Modal -->
  <div id="privacyModal" role="dialog" aria-modal="true" aria-hidden="true" class="hidden" style="position:fixed; inset:0; display:grid; place-items:center; z-index:60;">
    <div style="position:absolute; inset:0; background:rgba(0,0,0,0.45)" id="privacyBackdrop"></div>
    <div class="card" style="width:min(920px,95%); max-height:90vh; overflow:auto; position:relative; z-index:61; padding:1.25rem">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem">
        <h3 style="margin:0">Privacy Policy — Compressly</h3>
        <button id="closePrivacy" class="btn secondary">Close</button>
      </div>

      <section style="margin-top:1rem; color:var(--muted);">
        <p>Compressly performs all image processing locally in your browser. We do <strong>not</strong> upload your images to any server. EXIF/IPTC metadata is removed when you compress (if "Remove EXIF" is checked). We collect no personal user data by default.</p>
        <h4>Ads & External Services</h4>
        <p>Advertisement placeholders in the UI may load third-party content (e.g., Google AdSense) when you add your AdSense code. Those third-party services may collect usage data according to their privacy policies — you should review and comply with their policies.</p>

        <h4>Analytics</h4>
        <p>Compressly does not include analytics by default. If you add analytics code, disclose the collection practices here and add a cookie/consent banner as needed.</p>

        <h4>Contact</h4>
        <p>For privacy requests, please contact: <a href="mailto:contact@compressly.example">contact@compressly.example</a></p>

        <h4>Changes</h4>
        <p>We may update this privacy policy — the latest version will always be available on this page.</p>
      </section>
    </div>
  </div>

  <script>
  // Basic UI wiring and client-side compression logic
  (function(){
    const MAX_MB = 10;
    const uploader = document.getElementById('uploader');
    const fileInput = document.getElementById('fileInput');
    const browseBtn = document.getElementById('browseBtn');
    const qualityRange = document.getElementById('qualityRange');
    const qualityVal = document.getElementById('qualityVal');
    const presetLow = document.getElementById('presetLow');
    const presetMed = document.getElementById('presetMed');
    const presetHigh = document.getElementById('presetHigh');
    const stripExif = document.getElementById('stripExif');
    const formatSelect = document.getElementById('formatSelect');
    const resultArea = document.getElementById('resultArea');
    const resultCardWrap = document.getElementById('resultCardWrap');
    const previewImg = document.getElementById('previewImg');
    const fileNameEl = document.getElementById('fileName');
    const sizeInfo = document.getElementById('sizeInfo');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const privacyModal = document.getElementById('privacyModal');
    const privacyBtn = document.getElementById('privacyBtn');
    const closePrivacy = document.getElementById('closePrivacy');
    const privacyLink = document.getElementById('privacyLink');
    const privacyBackdrop = document.getElementById('privacyBackdrop');
    const themeToggle = document.getElementById('themeToggle');
    const thumbWrap = document.getElementById('thumbWrap');
    const yearEl = document.getElementById('year');

    yearEl.textContent = new Date().getFullYear();

    let originalFile = null;
    let compressedBlob = null;
    let compressedName = '';

    // Theme toggle
    function setTheme(theme){
      document.body.setAttribute('data-theme', theme);
      themeToggle.classList.toggle('on', theme === 'dark');
      themeToggle.setAttribute('aria-pressed', theme === 'dark');
    }
    setTheme(localStorage.getItem('compressly-theme') || 'light');
    themeToggle.addEventListener('click', ()=> {
      const next = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      localStorage.setItem('compressly-theme', next);
      setTheme(next);
    });

    // Privacy modal
    function openPrivacy(){ privacyModal.classList.remove('hidden'); privacyModal.setAttribute('aria-hidden','false'); }
    function closePrivacyModal(){ privacyModal.classList.add('hidden'); privacyModal.setAttribute('aria-hidden','true'); }
    privacyBtn.addEventListener('click', openPrivacy);
    privacyLink.addEventListener('click', (e)=>{ e.preventDefault(); openPrivacy(); });
    closePrivacy.addEventListener('click', closePrivacyModal);
    privacyBackdrop.addEventListener('click', closePrivacyModal);

    // File selection
    browseBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=> handleFile(e.target.files && e.target.files[0]));

    // Drag & drop
    function prevent(e){ e.preventDefault(); e.stopPropagation(); }
    ['dragenter','dragover','dragleave','drop'].forEach(ev => {
      uploader.addEventListener(ev, prevent);
    });
    uploader.addEventListener('dragover', ()=> uploader.classList.add('dragover'));
    uploader.addEventListener('dragleave', ()=> uploader.classList.remove('dragover'));
    uploader.addEventListener('drop', (e)=> {
      uploader.classList.remove('dragover');
      const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) handleFile(f);
    });

    // Quality slider display
    qualityRange.addEventListener('input', ()=> qualityVal.textContent = qualityRange.value + '%');

    // Presets
    presetLow.addEventListener('click', ()=> { qualityRange.value = 60; qualityVal.textContent = '60%'; });
    presetMed.addEventListener('click', ()=> { qualityRange.value = 85; qualityVal.textContent = '85%'; });
    presetHigh.addEventListener('click', ()=> { qualityRange.value = 95; qualityVal.textContent = '95%'; });

    // Reset
    resetBtn.addEventListener('click', resetAll);

    function bytesToSize(bytes){
      if(bytes === 0) return '0 B';
      const k = 1024; const sizes = ['B','KB','MB','GB'];
      const i = Math.floor(Math.log(bytes)/Math.log(k));
      return parseFloat((bytes / Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showError(msg){
      resultArea.innerHTML = `<div class="card" style="border-left:4px solid #ff4d4f; color:var(--muted)"><strong style="color:#ff4d4f">Error:</strong> ${msg}</div>`;
    }

    function resetAll(){
      originalFile = null; compressedBlob = null; compressedName = '';
      fileInput.value = '';
      resultArea.innerHTML = '';
      resultCardWrap.style.display = 'none';
      previewImg.src = '';
    }

    // Main handler
    async function handleFile(file){
      resetAll();
      if(!file) return;
      if(file.size > MAX_MB * 1024 * 1024){
        showError(`File exceeds ${MAX_MB} MB limit.`);
        return;
      }
      // allow image mime types only
      if(!file.type.startsWith('image/')){
        showError('Unsupported file type. Please upload an image.');
        return;
      }

      originalFile = file;
      const origName = file.name;
      fileNameEl.textContent = origName;

      // Show preview (for SVG/GIF still show preview)
      const url = URL.createObjectURL(file);
      previewImg.src = url;

      // Show meta
      sizeInfo.textContent = `Original: ${bytesToSize(file.size)} • Compressed: —`;

      // Render compress button
      resultArea.innerHTML = `
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem">
            <div>
              <div style="font-weight:700">Ready to compress</div>
              <div class="muted">Choose quality and output format, then press Compress</div>
            </div>
            <div style="display:flex; gap:.5rem">
              <button id="compressBtn" class="btn">Compress</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('compressBtn').addEventListener('click', ()=> compressFile(file));
    }

    // Compression core
    async function compressFile(file){
      if(!file) return;
      resultArea.innerHTML = `<div class="card"><div style="display:flex;gap:1rem;align-items:center"><div class="spinner" aria-hidden></div><div class="muted">Compressing... this happens locally in your browser</div></div></div>`;
      const quality = Math.max(1, Math.min(100, parseInt(qualityRange.value || '85', 10)));
      const outFormat = formatSelect.value === 'orig' ? file.type : formatSelect.value;
      const removeExif = stripExif.checked;

      try {
        const blob = await imageToBlob(file, outFormat, quality/100, removeExif);
        compressedBlob = blob;
        compressedName = buildName(file.name, outFormat);
        showResult(blob, file.name, compressedName);
      } catch(err){
        console.error(err);
        showError('Compression failed — your browser may not support the requested output format.');
      }
    }

    // Build download name
    function buildName(origName, outMime){
      const ext = mimeToExt(outMime) || (origName.split('.').pop());
      const base = origName.replace(/\.[^/.]+$/, "");
      return `${base}-compressed.${ext}`;
    }
    function mimeToExt(mime){
      if(!mime) return null;
      if(mime.includes('jpeg')||mime.includes('jpg')) return 'jpg';
      if(mime.includes('png')) return 'png';
      if(mime.includes('webp')) return 'webp';
      if(mime.includes('avif')) return 'avif';
      if(mime.includes('svg')) return 'svg';
      return null;
    }

    // Convert image file to compressed Blob via canvas
    // Supports rasterization of SVG, GIF (first frame), and typical raster images.
    async function imageToBlob(file, outMime, quality=0.85, removeExif=true){
      // If outMime = image/png and quality is ignored by toBlob for png
      const img = await loadImageFromFile(file);
      const width = img.width;
      const height = img.height;

      // Create canvas with image dimensions (cap at something large to avoid huge memory; but keep original by default)
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');

      // Fill white for PNG/JPEG if necessary (to handle transparent images if converting to jpeg)
      if(outMime && outMime.includes('jpeg')){
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,canvas.width,canvas.height);
      }

      // Draw image onto canvas — this strips EXIF metadata automatically
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      // For PNG, provide lossless conversion (quality ignored)
      // For SVG output selection we will export PNG/JPEG/WEBP and name .svg (since true SVG compression isn't rasterization)
      let targetMime = outMime;
      if(outMime === 'image/svg+xml'){
        // We will rasterize SVG then give a PNG, but still use .svg extension isn't valid.
        // Instead, fallback to PNG output
        targetMime = 'image/png';
      }

      // Attempt to use canvas.toBlob with desired mime and quality
      const blob = await new Promise((resolve, reject) => {
        // Special handling: AVIF might not be supported; try fallbacks
        const tryToBlob = (mime) => {
          try {
            canvas.toBlob((b) => {
              if(b && b.size > 0) resolve(b);
              else reject(new Error('Empty blob returned'));
            }, mime, mime.includes('png') ? undefined : quality);
          } catch(e) {
            reject(e);
          }
        };

        // If target is avif or webp or jpeg, try those; otherwise default to png
        if(targetMime === 'image/avif' || targetMime === 'image/webp' || targetMime === 'image/jpeg' || targetMime === 'image/png'){
          tryToBlob(targetMime);
        } else {
          // fallback
          tryToBlob('image/png');
        }
      });

      return blob;
    }

    // Utility: load image from file (handles SVGs & GIFs by using objectURL)
    function loadImageFromFile(file){
      return new Promise((resolve, reject) => {
        const url = URL.createObjectURL(file);
        const img = new Image();

        // To allow cross-origin SVG rasterization in some contexts, set crossOrigin if needed:
        // img.crossOrigin = 'anonymous';

        img.onload = () => {
          URL.revokeObjectURL(url);
          resolve(img);
        };
        img.onerror = (e) => {
          URL.revokeObjectURL(url);
          reject(new Error('Failed to load image'));
        };
        img.src = url;
      });
    }

    function showResult(blob, origName, outName){
      resultArea.innerHTML = '';
      resultCardWrap.style.display = 'block';
      compressedBlob = blob;

      // Update preview thumbnail (use blob URL)
      const blobUrl = URL.createObjectURL(blob);
      previewImg.src = blobUrl;

      fileNameEl.textContent = outName;
      sizeInfo.textContent = `Original: ${bytesToSize(originalFile.size)} • Compressed: ${bytesToSize(blob.size)}`;

      downloadBtn.onclick = () => {
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = outName;
        document.body.appendChild(a);
        a.click();
        a.remove();
      };

      // Show small "copressed" card below (also includes a small preview & info)
      resultArea.innerHTML = `
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem">
            <div>
              <div style="font-weight:700">Compression complete</div>
              <div class="muted">Download your compressed image below. EXIF removed: ${stripExif.checked ? 'Yes' : 'No'}</div>
            </div>
            <div style="display:flex; gap:.5rem; align-items:center">
              <button id="downloadBtn2" class="btn">Download</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('downloadBtn2').addEventListener('click', () => {
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = outName;
        document.body.appendChild(a);
        a.click();
        a.remove();
      });

      // Accessibility focus
      document.getElementById('downloadBtn2').focus();
    }

    // initialize drag-drop click area accessibility
    uploader.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' ') fileInput.click();
    });

    // Provide quick keyboard shortcuts (C to compress when file loaded)
    window.addEventListener('keydown', (e)=>{
      if((e.key === 'c' || e.key === 'C') && originalFile){
        e.preventDefault();
        compressFile(originalFile);
      }
    });

    // Placeholder: AdSense initialization comment
    // To enable AdSense, paste your publisher ID and ad unit code in the ad placeholders.
    // Example:
    // <script data-ad-client="ca-pub-XXXXXXXXXXXX" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    // then use <ins class="adsbygoogle" data-ad-slot="NNNNNN" ...> etc.

    // Basic feature detection message
    if(!window.File || !window.FileReader || !window.Blob){
      showError('Your browser does not support the required file APIs. Please update your browser.');
    }

  })();
  </script>
</body>
</html>